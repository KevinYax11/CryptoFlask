{% extends "base.html" %}

{% block title %}CryptoFlask - Firmar{% endblock %}

{% block content %}
<div class="section">
    <h2>
        <span class="section-number">S</span>
        Firmar Mensaje
    </h2>
    
    <form action="{{ url_for('route_sign') }}" method="POST" class="form-primary">
        <div class="form-group">
            <label for="sign_message">Mensaje para firmar</label>
            <div style="position: relative;">
                <textarea id="sign_message" name="message" placeholder="Ingrese el mensaje que desea firmar digitalmente" required></textarea>
                <button type="button" class="btn-paste" onclick="pasteText('sign_message')">Pegar</button>
            </div>
        </div>
        <div class="form-group">
            <label for="sign_key_name">Nombre de la clave privada</label>
            <input type="text" id="sign_key_name" name="key_name" placeholder="Ejemplo: mis_claves" required>
            <small class="helper-text">Ingrese el nombre sin extensión de archivo</small>
        </div>
        <button type="submit" class="btn-primary">Firmar con Clave Privada</button>
    </form>
    
    {% if signature %}
        <div class="result">
            <div class="result-header">
                <strong>Firma Digital</strong>
                <div class="result-actions">
                    <span class="result-badge">Base64</span>
                    <button type="button" class="btn-copy" onclick="copyToClipboard('signature-content', this)">Copiar</button>
                </div>
            </div>
            <div class="result-content" id="signature-content">{{ signature }}</div>
        </div>
    {% endif %}
</div>

<script>
function copyToClipboard(elementId, button) {
    const text = document.getElementById(elementId).textContent;
    navigator.clipboard.writeText(text).then(() => {
        const originalText = button.textContent;
        button.textContent = 'Copiado';
        button.classList.add('copied');
        setTimeout(() => {
            button.textContent = originalText;
            button.classList.remove('copied');
        }, 2000);
    });
}

async function pasteText(textareaId) {
    try {
        const text = await navigator.clipboard.readText();
        document.getElementById(textareaId).value = text;
    } catch (err) {
        alert('No se pudo pegar el texto. Asegúrese de dar permisos al navegador.');
    }
}
</script>
{% endblock %}